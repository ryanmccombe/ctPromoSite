;(function($,g,h,j){var k='stellar',defaults={scrollProperty:'scroll',positionProperty:'position',horizontalScrolling:true,verticalScrolling:true,horizontalOffset:0,verticalOffset:0,responsive:false,parallaxBackgrounds:true,parallaxElements:true,hideDistantElements:true,hideElement:function(a){a.hide()},showElement:function(a){a.show()}},scrollProperty={scroll:{getLeft:function(a){return a.scrollLeft()},setLeft:function(a,b){a.scrollLeft(b)},getTop:function(a){return a.scrollTop()},setTop:function(a,b){a.scrollTop(b)}},position:{getLeft:function(a){return parseInt(a.css('left'),10)*-1},getTop:function(a){return parseInt(a.css('top'),10)*-1}},margin:{getLeft:function(a){return parseInt(a.css('margin-left'),10)*-1},getTop:function(a){return parseInt(a.css('margin-top'),10)*-1}},transform:{getLeft:function(a){var b=getComputedStyle(a[0])[prefixedTransform];return(b!=='none'?parseInt(b.match(/(-?[0-9]+)/g)[4],10)*-1:0)},getTop:function(a){var b=getComputedStyle(a[0])[prefixedTransform];return(b!=='none'?parseInt(b.match(/(-?[0-9]+)/g)[5],10)*-1:0)}}},positionProperty={position:{setLeft:function(a,b){a.css('left',b)},setTop:function(a,b){a.css('top',b)}},transform:{setPosition:function(a,b,c,d,e){a[0].style[prefixedTransform]='translate3d('+(b-c)+'px, '+(d-e)+'px, 0)'}}},vendorPrefix=(function(){var b=/^(Moz|Webkit|Khtml|O|ms|Icab)(?=[A-Z])/,style=$('script')[0].style,prefix='',prop;for(prop in style){if(b.test(prop)){prefix=prop.match(b)[0];break}}if('WebkitOpacity'in style){prefix='Webkit'}if('KhtmlOpacity'in style){prefix='Khtml'}return function(a){return prefix+(prefix.length>0?a.charAt(0).toUpperCase()+a.slice(1):a)}}()),prefixedTransform=vendorPrefix('transform'),supportsBackgroundPositionXY=$('<div />',{style:'background:#fff'}).css('background-position-x')!==j,setBackgroundPosition=(supportsBackgroundPositionXY?function(a,x,y){a.css({'background-position-x':x,'background-position-y':y})}:function(a,x,y){a.css('background-position',x+' '+y)}),getBackgroundPosition=(supportsBackgroundPositionXY?function(a){return[a.css('background-position-x'),a.css('background-position-y')]}:function(a){return a.css('background-position').split(' ')}),requestAnimFrame=(g.requestAnimationFrame||g.webkitRequestAnimationFrame||g.mozRequestAnimationFrame||g.oRequestAnimationFrame||g.msRequestAnimationFrame||function(a){setTimeout(a,1000/60)});function Plugin(a,b){this.element=a;this.options=$.extend({},defaults,b);this._defaults=defaults;this._name=k;this.init()}Plugin.prototype={init:function(){this.options.name=k+'_'+Math.floor(Math.random()*1e9);this._defineElements();this._defineGetters();this._defineSetters();this._handleWindowLoadAndResize();this._detectViewport();this.refresh({firstLoad:true});if(this.options.scrollProperty==='scroll'){this._handleScrollEvent()}else{this._startAnimationLoop()}},_defineElements:function(){if(this.element===h.body)this.element=g;this.$scrollElement=$(this.element);this.$element=(this.element===g?$('body'):this.$scrollElement);this.$viewportElement=(this.options.viewportElement!==j?$(this.options.viewportElement):(this.$scrollElement[0]===g||this.options.scrollProperty==='scroll'?this.$scrollElement:this.$scrollElement.parent()))},_defineGetters:function(){var a=this,scrollPropertyAdapter=scrollProperty[a.options.scrollProperty];this._getScrollLeft=function(){return scrollPropertyAdapter.getLeft(a.$scrollElement)};this._getScrollTop=function(){return scrollPropertyAdapter.getTop(a.$scrollElement)}},_defineSetters:function(){var f=this,scrollPropertyAdapter=scrollProperty[f.options.scrollProperty],positionPropertyAdapter=positionProperty[f.options.positionProperty],setScrollLeft=scrollPropertyAdapter.setLeft,setScrollTop=scrollPropertyAdapter.setTop;this._setScrollLeft=(typeof setScrollLeft==='function'?function(a){setScrollLeft(f.$scrollElement,a)}:$.noop);this._setScrollTop=(typeof setScrollTop==='function'?function(a){setScrollTop(f.$scrollElement,a)}:$.noop);this._setPosition=positionPropertyAdapter.setPosition||function(a,b,c,d,e){if(f.options.horizontalScrolling){positionPropertyAdapter.setLeft(a,b,c)}if(f.options.verticalScrolling){positionPropertyAdapter.setTop(a,d,e)}}},_handleWindowLoadAndResize:function(){var a=this,$window=$(g);if(a.options.responsive){$window.bind('load.'+this.name,function(){a.refresh()})}$window.bind('resize.'+this.name,function(){a._detectViewport();if(a.options.responsive){a.refresh()}})},refresh:function(b){var c=this,oldLeft=c._getScrollLeft(),oldTop=c._getScrollTop();if(!b||!b.firstLoad){this._reset()}this._setScrollLeft(0);this._setScrollTop(0);this._setOffsets();this._findParticles();this._findBackgrounds();if(b&&b.firstLoad&&/WebKit/.test(navigator.userAgent)){$(g).load(function(){var a=c._getScrollLeft(),oldTop=c._getScrollTop();c._setScrollLeft(a+1);c._setScrollTop(oldTop+1);c._setScrollLeft(a);c._setScrollTop(oldTop)})}this._setScrollLeft(oldLeft);this._setScrollTop(oldTop)},_detectViewport:function(){var a=this.$viewportElement.offset(),hasOffsets=a!==null&&a!==j;this.viewportWidth=this.$viewportElement.width();this.viewportHeight=this.$viewportElement.height();this.viewportOffsetTop=(hasOffsets?a.top:0);this.viewportOffsetLeft=(hasOffsets?a.left:0)},_findParticles:function(){var c=this,scrollLeft=this._getScrollLeft(),scrollTop=this._getScrollTop();if(this.particles!==j){for(var i=this.particles.length-1;i>=0;i--){this.particles[i].$element.data('stellar-elementIsActive',j)}}this.particles=[];if(!this.options.parallaxElements)return;this.$element.find('[data-stellar-ratio]').each(function(i){var b=$(this),horizontalOffset,verticalOffset,positionLeft,positionTop,marginLeft,marginTop,$offsetParent,offsetLeft,offsetTop,parentOffsetLeft=0,parentOffsetTop=0,tempParentOffsetLeft=0,tempParentOffsetTop=0;if(!b.data('stellar-elementIsActive')){b.data('stellar-elementIsActive',this)}else if(b.data('stellar-elementIsActive')!==this){return}c.options.showElement(b);if(!b.data('stellar-startingLeft')){b.data('stellar-startingLeft',b.css('left'));b.data('stellar-startingTop',b.css('top'))}else{b.css('left',b.data('stellar-startingLeft'));b.css('top',b.data('stellar-startingTop'))}positionLeft=b.position().left;positionTop=b.position().top;marginLeft=(b.css('margin-left')==='auto')?0:parseInt(b.css('margin-left'),10);marginTop=(b.css('margin-top')==='auto')?0:parseInt(b.css('margin-top'),10);offsetLeft=b.offset().left-marginLeft;offsetTop=b.offset().top-marginTop;b.parents().each(function(){var a=$(this);if(a.data('stellar-offset-parent')===true){parentOffsetLeft=tempParentOffsetLeft;parentOffsetTop=tempParentOffsetTop;$offsetParent=a;return false}else{tempParentOffsetLeft+=a.position().left;tempParentOffsetTop+=a.position().top}});horizontalOffset=(b.data('stellar-horizontal-offset')!==j?b.data('stellar-horizontal-offset'):($offsetParent!==j&&$offsetParent.data('stellar-horizontal-offset')!==j?$offsetParent.data('stellar-horizontal-offset'):c.horizontalOffset));verticalOffset=(b.data('stellar-vertical-offset')!==j?b.data('stellar-vertical-offset'):($offsetParent!==j&&$offsetParent.data('stellar-vertical-offset')!==j?$offsetParent.data('stellar-vertical-offset'):c.verticalOffset));c.particles.push({$element:b,$offsetParent:$offsetParent,isFixed:b.css('position')==='fixed',horizontalOffset:horizontalOffset,verticalOffset:verticalOffset,startingPositionLeft:positionLeft,startingPositionTop:positionTop,startingOffsetLeft:offsetLeft,startingOffsetTop:offsetTop,parentOffsetLeft:parentOffsetLeft,parentOffsetTop:parentOffsetTop,stellarRatio:(b.data('stellar-ratio')!==j?b.data('stellar-ratio'):1),width:b.outerWidth(true),height:b.outerHeight(true),isHidden:false})})},_findBackgrounds:function(){var c=this,scrollLeft=this._getScrollLeft(),scrollTop=this._getScrollTop(),$backgroundElements;this.backgrounds=[];if(!this.options.parallaxBackgrounds)return;$backgroundElements=this.$element.find('[data-stellar-background-ratio]');if(this.$element.data('stellar-background-ratio')){$backgroundElements=$backgroundElements.add(this.$element)}$backgroundElements.each(function(){var b=$(this),backgroundPosition=getBackgroundPosition(b),horizontalOffset,verticalOffset,positionLeft,positionTop,marginLeft,marginTop,offsetLeft,offsetTop,$offsetParent,parentOffsetLeft=0,parentOffsetTop=0,tempParentOffsetLeft=0,tempParentOffsetTop=0;if(!b.data('stellar-backgroundIsActive')){b.data('stellar-backgroundIsActive',this)}else if(b.data('stellar-backgroundIsActive')!==this){return}if(!b.data('stellar-backgroundStartingLeft')){b.data('stellar-backgroundStartingLeft',backgroundPosition[0]);b.data('stellar-backgroundStartingTop',backgroundPosition[1])}else{setBackgroundPosition(b,b.data('stellar-backgroundStartingLeft'),b.data('stellar-backgroundStartingTop'))}marginLeft=(b.css('margin-left')==='auto')?0:parseInt(b.css('margin-left'),10);marginTop=(b.css('margin-top')==='auto')?0:parseInt(b.css('margin-top'),10);offsetLeft=b.offset().left-marginLeft-scrollLeft;offsetTop=b.offset().top-marginTop-scrollTop;b.parents().each(function(){var a=$(this);if(a.data('stellar-offset-parent')===true){parentOffsetLeft=tempParentOffsetLeft;parentOffsetTop=tempParentOffsetTop;$offsetParent=a;return false}else{tempParentOffsetLeft+=a.position().left;tempParentOffsetTop+=a.position().top}});horizontalOffset=(b.data('stellar-horizontal-offset')!==j?b.data('stellar-horizontal-offset'):($offsetParent!==j&&$offsetParent.data('stellar-horizontal-offset')!==j?$offsetParent.data('stellar-horizontal-offset'):c.horizontalOffset));verticalOffset=(b.data('stellar-vertical-offset')!==j?b.data('stellar-vertical-offset'):($offsetParent!==j&&$offsetParent.data('stellar-vertical-offset')!==j?$offsetParent.data('stellar-vertical-offset'):c.verticalOffset));c.backgrounds.push({$element:b,$offsetParent:$offsetParent,isFixed:b.css('background-attachment')==='fixed',horizontalOffset:horizontalOffset,verticalOffset:verticalOffset,startingValueLeft:backgroundPosition[0],startingValueTop:backgroundPosition[1],startingBackgroundPositionLeft:(isNaN(parseInt(backgroundPosition[0],10))||-1!==backgroundPosition[0].indexOf('%')?0:parseInt(backgroundPosition[0],10)),startingBackgroundPositionTop:(isNaN(parseInt(backgroundPosition[1],10))||-1!==backgroundPosition[1].indexOf('%')?0:parseInt(backgroundPosition[1],10)),startingPositionLeft:b.position().left,startingPositionTop:b.position().top,startingOffsetLeft:offsetLeft,startingOffsetTop:offsetTop,parentOffsetLeft:parentOffsetLeft,parentOffsetTop:parentOffsetTop,stellarRatio:(b.data('stellar-background-ratio')===j?1:b.data('stellar-background-ratio'))})})},_reset:function(){var a,startingPositionLeft,startingPositionTop,background,i;for(i=this.particles.length-1;i>=0;i--){a=this.particles[i];startingPositionLeft=a.$element.data('stellar-startingLeft');startingPositionTop=a.$element.data('stellar-startingTop');this._setPosition(a.$element,startingPositionLeft,startingPositionLeft,startingPositionTop,startingPositionTop);this.options.showElement(a.$element);a.$element.data('stellar-startingLeft',null).data('stellar-elementIsActive',null).data('stellar-backgroundIsActive',null)}for(i=this.backgrounds.length-1;i>=0;i--){background=this.backgrounds[i];background.$element.data('stellar-backgroundStartingLeft',null).data('stellar-backgroundStartingTop',null);setBackgroundPosition(background.$element,background.startingValueLeft,background.startingValueTop)}},destroy:function(){this._reset();this.$scrollElement.unbind('resize.'+this.name).unbind('scroll.'+this.name);this._animationLoop=$.noop;$(g).unbind('load.'+this.name).unbind('resize.'+this.name)},_setOffsets:function(){var a=this,$window=$(g);$window.unbind('resize.horizontal-'+this.name).unbind('resize.vertical-'+this.name);if(typeof this.options.horizontalOffset==='function'){this.horizontalOffset=this.options.horizontalOffset();$window.bind('resize.horizontal-'+this.name,function(){a.horizontalOffset=a.options.horizontalOffset()})}else{this.horizontalOffset=this.options.horizontalOffset}if(typeof this.options.verticalOffset==='function'){this.verticalOffset=this.options.verticalOffset();$window.bind('resize.vertical-'+this.name,function(){a.verticalOffset=a.options.verticalOffset()})}else{this.verticalOffset=this.options.verticalOffset}},_repositionElements:function(){var a=this._getScrollLeft(),scrollTop=this._getScrollTop(),horizontalOffset,verticalOffset,particle,fixedRatioOffset,background,bgLeft,bgTop,isVisibleVertical=true,isVisibleHorizontal=true,newPositionLeft,newPositionTop,newOffsetLeft,newOffsetTop,i;if(this.currentScrollLeft===a&&this.currentScrollTop===scrollTop&&this.currentWidth===this.viewportWidth&&this.currentHeight===this.viewportHeight){return}else{this.currentScrollLeft=a;this.currentScrollTop=scrollTop;this.currentWidth=this.viewportWidth;this.currentHeight=this.viewportHeight}for(i=this.particles.length-1;i>=0;i--){particle=this.particles[i];fixedRatioOffset=(particle.isFixed?1:0);if(this.options.horizontalScrolling){newPositionLeft=(a+particle.horizontalOffset+this.viewportOffsetLeft+particle.startingPositionLeft-particle.startingOffsetLeft+particle.parentOffsetLeft)*-(particle.stellarRatio+fixedRatioOffset-1)+particle.startingPositionLeft;newOffsetLeft=newPositionLeft-particle.startingPositionLeft+particle.startingOffsetLeft}else{newPositionLeft=particle.startingPositionLeft;newOffsetLeft=particle.startingOffsetLeft}if(this.options.verticalScrolling){newPositionTop=(scrollTop+particle.verticalOffset+this.viewportOffsetTop+particle.startingPositionTop-particle.startingOffsetTop+particle.parentOffsetTop)*-(particle.stellarRatio+fixedRatioOffset-1)+particle.startingPositionTop;newOffsetTop=newPositionTop-particle.startingPositionTop+particle.startingOffsetTop}else{newPositionTop=particle.startingPositionTop;newOffsetTop=particle.startingOffsetTop}if(this.options.hideDistantElements){isVisibleHorizontal=!this.options.horizontalScrolling||newOffsetLeft+particle.width>(particle.isFixed?0:a)&&newOffsetLeft<(particle.isFixed?0:a)+this.viewportWidth+this.viewportOffsetLeft;isVisibleVertical=!this.options.verticalScrolling||newOffsetTop+particle.height>(particle.isFixed?0:scrollTop)&&newOffsetTop<(particle.isFixed?0:scrollTop)+this.viewportHeight+this.viewportOffsetTop}if(isVisibleHorizontal&&isVisibleVertical){if(particle.isHidden){this.options.showElement(particle.$element);particle.isHidden=false}this._setPosition(particle.$element,newPositionLeft,particle.startingPositionLeft,newPositionTop,particle.startingPositionTop)}else{if(!particle.isHidden){this.options.hideElement(particle.$element);particle.isHidden=true}}}for(i=this.backgrounds.length-1;i>=0;i--){background=this.backgrounds[i];fixedRatioOffset=(background.isFixed?0:1);bgLeft=(this.options.horizontalScrolling?(a+background.horizontalOffset-this.viewportOffsetLeft-background.startingOffsetLeft+background.parentOffsetLeft-background.startingBackgroundPositionLeft)*(fixedRatioOffset-background.stellarRatio)+'px':background.startingValueLeft);bgTop=(this.options.verticalScrolling?(scrollTop+background.verticalOffset-this.viewportOffsetTop-background.startingOffsetTop+background.parentOffsetTop-background.startingBackgroundPositionTop)*(fixedRatioOffset-background.stellarRatio)+'px':background.startingValueTop);setBackgroundPosition(background.$element,bgLeft,bgTop)}},_handleScrollEvent:function(){var a=this,ticking=false;var b=function(){a._repositionElements();ticking=false};var c=function(){if(!ticking){requestAnimFrame(b);ticking=true}};this.$scrollElement.bind('scroll.'+this.name,c);c()},_startAnimationLoop:function(){var a=this;this._animationLoop=function(){requestAnimFrame(a._animationLoop);a._repositionElements()};this._animationLoop()}};$.fn[k]=function(b){var c=arguments;if(b===j||typeof b==='object'){return this.each(function(){if(!$.data(this,'plugin_'+k)){$.data(this,'plugin_'+k,new Plugin(this,b))}})}else if(typeof b==='string'&&b[0]!=='_'&&b!=='init'){return this.each(function(){var a=$.data(this,'plugin_'+k);if(a instanceof Plugin&&typeof a[b]==='function'){a[b].apply(a,Array.prototype.slice.call(c,1))}if(b==='destroy'){$.data(this,'plugin_'+k,null)}})}};$[k]=function(a){var b=$(g);return b.stellar.apply(b,Array.prototype.slice.call(arguments,0))};$[k].scrollProperty=scrollProperty;$[k].positionProperty=positionProperty;g.Stellar=Plugin}(jQuery,this,document));